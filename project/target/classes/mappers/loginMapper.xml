<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.dongyang.project.loginMapper">
	<select id="selectManager" resultType="com.dongyang.project.domain.LoginVO">
		select * from MANAGER_MASTER where 1=1 and MID = #{mid}
	</select>
	<select id="insertManager" resultType="com.dongyang.project.domain.LoginVO">
		insert into MANAGER_MASTER(SITE_TID,MID,MPW,NAME,CREATE_DATE) VALUES(#{site_tid},#{mid},#{mpw},#{name},#{create_date})
	</select>
	<select id="insertImageManager" resultType="com.dongyang.project.domain.ImageVO">
		insert into ImageEntity(content,fileName,mimeType) VALUES(#{content},#{fileName},#{mimeType})
	</select>
	<select id="selectProduct" resultType="com.dongyang.project.domain.ProductVO">
		select * from PRODUCT_LIST where 1=1 and SITE_TID = '1'
	</select>
	<select id="searchProduct" parameterType="hashmap" resultType="com.dongyang.project.domain.ProductVO">
	  SELECT * FROM PRODUCT_LIST WHERE 1=1 AND SITE_TID = #{site}
  	  <choose>
	    <when test="keyword != null and type != null and type.equals('ALL')">
	    	AND NAME = #{keyword} OR BARCODE = #{keyword}
	    </when>
	    <when test="keyword != null and type != null and type.equals('NAME')">
	    	AND NAME = #{keyword}
	    </when>
	    <otherwise>
	    	AND BARCODE = #{keyword}
	    </otherwise>
	  </choose>
	</select>
	<select id="selectImage" resultType="com.dongyang.project.domain.ImageVO">
		select * from ImageEntity where 1=1 and id = #{id}
	</select>
	<select id="nextTidManager" resultType="com.dongyang.project.domain.ProductVO">
		select IFNULL(max(TID)+1,1) as TID from PRODUCT_LIST
	</select>
	<select id="insertPro" resultType="com.dongyang.project.domain.ProductVO">
		insert into PRODUCT_LIST(SITE_TID,IMAGE_ID,NAME,PRICE,COUNT,BARCODE) VALUES('1',(select max(id) from ImageEntity),#{name},#{price},#{count},#{barcode})
	</select>
	<select id="selectProductInfo" resultType="com.dongyang.project.domain.ProductVO">
		select * from PRODUCT_LIST where 1=1 and BARCODE = #{barcode}
	</select>
	<select id="updateProductIn" resultType="com.dongyang.project.domain.ProductVO">
		update PRODUCT_LIST set count = count + #{count} where 1=1 and BARCODE = #{barcode}
	</select>
	<select id="updateProductOut" resultType="com.dongyang.project.domain.ProductVO">
		update PRODUCT_LIST set count = count - #{count} where 1=1 and BARCODE = #{barcode}
	</select>
	<select id="selectOrder" resultType="com.dongyang.project.domain.OrderVO">
		select *, (select name from SITE where 1=1 and TID = SITE_TID) SITE_NAME from ORDER_LIST where 1=1
		<if test="null != _parameter and _parameter != 1">
			and SITE_TID = #{_parameter}
		</if>
	</select>
		<select id="selectReturn" resultType="com.dongyang.project.domain.ReturnVO">
		select *, (select name from SITE where 1=1 and TID = SITE_TID) SITE_NAME from RETURN_LIST where 1=1
		<if test="null != _parameter and _parameter != 1">
			and SITE_TID = #{_parameter}
		</if>
	</select>
	<select id="insertOrder" resultType="com.dongyang.project.domain.OrderVO">
		insert into ORDER_LIST(SITE_TID, ORDER_NAME, PRODUCT_NAME, PRODUCT_CODE, COUNT, DESCRIPTION, CREATE_DATE) 
		VALUES(#{site},#{order},#{orderName},#{orderCode},#{orderCount},#{orderDesc},#{date})
	</select>
	<select id="insertReturn" resultType="com.dongyang.project.domain.ReturnVO">
		insert into RETURN_LIST(SITE_TID, PRODUCT_NAME, PRODUCT_CODE, COUNT, DESCRIPTION, CREATE_DATE) 
		VALUES(#{site},#{returnName},#{returnCode},#{returnCount},#{returnReason},#{date})
	</select>
	<select id="selectCommunity" resultType="com.dongyang.project.domain.CommunityVO">
		select *, (SELECT NAME FROM MANAGER_MASTER WHERE 1=1 AND TID = USER_MASTER_TID) USER_NAME from COMMUNITY order by CREATE_DATE DESC
	</select>
	<select id="insertCommunity" resultType="com.dongyang.project.domain.CommunityVO">
		insert into COMMUNITY(SITE_TID, USER_MASTER_TID, TITLE, CONTENTS, CREATE_DATE) 
		VALUES(#{site},#{userTid},#{title},#{contents},#{date})
	</select>
	<select id="selectCommunityBean" resultType="com.dongyang.project.domain.CommunityVO">
		select *, (SELECT NAME FROM MANAGER_MASTER WHERE 1=1 AND TID = USER_MASTER_TID) USER_NAME from COMMUNITY WHERE TID = #{_parameter}
	</select>	
	<select id="deleteCommunity" resultType="com.dongyang.project.domain.CommunityVO">
		delete from COMMUNITY WHERE TID = #{_parameter}
	</select>
	<select id="modifyCommunity" resultType="com.dongyang.project.domain.CommunityVO">
		update COMMUNITY set TITLE = #{title}, CONTENTS = #{contents}, MODIFY_DATE = #{date} where 1=1 and TID = #{tid}  
	</select>
	
	
	
	<select id="selectNotice" resultType="com.dongyang.project.domain.NoticeVO">
		select *, (SELECT NAME FROM MANAGER_MASTER WHERE 1=1 AND TID = USER_MASTER_TID) USER_NAME from NOTICE order by CREATE_DATE DESC
	</select>
	<select id="insertNotice" resultType="com.dongyang.project.domain.NoticeVO">
		insert into NOTICE(SITE_TID, USER_MASTER_TID, TITLE, CONTENTS, CREATE_DATE) 
		VALUES(#{site},#{userTid},#{title},#{contents},#{date})
	</select>
	<select id="selectNoticeBean" resultType="com.dongyang.project.domain.NoticeVO">
		select *, (SELECT NAME FROM MANAGER_MASTER WHERE 1=1 AND TID = USER_MASTER_TID) USER_NAME from NOTICE WHERE TID = #{_parameter}
	</select>	
	<select id="deleteNotice" resultType="com.dongyang.project.domain.NoticeVO">
		delete from NOTICE WHERE TID = #{_parameter}
	</select>
	<select id="modifyNotice" resultType="com.dongyang.project.domain.NoticeVO">
		update NOTICE set TITLE = #{title}, CONTENTS = #{contents}, MODIFY_DATE = #{date} where 1=1 and TID = #{tid}  
	</select>
</mapper>